services:
    # Frontend Application
    monochrome:
        image: ghcr.io/r0m1k3/monoflow:latest
        container_name: monochrome-app
        restart: unless-stopped
        ports:
            - '${MONOCHROME_PORT:-3001}:4173'
        environment:
            # URL interne Docker (server-to-server)
            # Par défaut, utilise le nom du service "pocketbase". Surchargé par POCKETBASE_URL.
            - POCKETBASE_URL=${POCKETBASE_URL:-http://pocketbase:8090}
            # URL PUBLIQUE de PocketBase, accessible depuis le navigateur.
            # ⚠️ DOIT être définie dans votre configuration Unraid/Docker si différente
            - PUBLIC_POCKETBASE_URL=${PUBLIC_POCKETBASE_URL:-https://pb.vonrodbox.eu}
            # Auth gate (optionnel)
            - AUTH_ENABLED=${AUTH_ENABLED:-false}
            - AUTH_SECRET=${AUTH_SECRET:-}
        depends_on:
            - pocketbase
        networks:
            - monochrome_net

    # Backend / Authentification & Sync (optionnel si vous utilisez l'instance publique)
    pocketbase:
        image: ghcr.io/muchobien/pocketbase:latest
        container_name: monochrome-pb
        restart: unless-stopped
        ports:
            - '${POCKETBASE_PORT:-8091}:8090'
        volumes:
            - ${HOST_DATA_PATH:-./data}/pb_data:/pb_data
            - ${HOST_DATA_PATH:-./data}/pb_public:/pb_public
            - ${HOST_DATA_PATH:-./data}/pb_hooks:/pb_hooks
        environment:
            - PB_ADMIN_EMAIL=${ADMIN_EMAIL:-admin@example.com}
            - PB_ADMIN_PASSWORD=${ADMIN_PASSWORD:-changeme}
        healthcheck:
            test: [ 'CMD', 'wget', '--no-verbose', '--tries=1', '--spider', 'http://localhost:8090/api/health' ]
            interval: 30s
            timeout: 10s
            retries: 3
        networks:
            - monochrome_net

networks:
    monochrome_net:
        driver: bridge
